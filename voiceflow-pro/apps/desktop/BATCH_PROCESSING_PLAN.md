Batch Processor Implementation Plan                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ Executive Summary                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ Transform the BatchProcessor component from dummy implementation to fully functional batch transcription processing with real backend integration, WebSocket real-time updates, and comprehensive unit    │ │
│ │ testing.                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Phase 1: Backend Infrastructure (API)                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                           │ │
│ │ 1.1 Database Schema Extension                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/api/prisma/schema.prisma                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ Add Models:                                                                                                                                                                                               │ │
│ │ model BatchJob {                                                                                                                                                                                          │ │
│ │   id                      String   @id @default(uuid())                                                                                                                                                   │ │
│ │   userId                  String                                                                                                                                                                          │ │
│ │   name                    String                                                                                                                                                                          │ │
│ │   status                  BatchJobStatus @default(DRAFT)                                                                                                                                                  │ │
│ │   concurrency             Int      @default(3)                                                                                                                                                            │ │
│ │   totalItems              Int      @default(0)                                                                                                                                                            │ │
│ │   completedItems          Int      @default(0)                                                                                                                                                            │ │
│ │   failedItems             Int      @default(0)                                                                                                                                                            │ │
│ │   estimatedTimeRemaining  Int?     // seconds                                                                                                                                                             │ │
│ │   throughputMbps          Float?                                                                                                                                                                          │ │
│ │   createdAt               DateTime @default(now())                                                                                                                                                        │ │
│ │   updatedAt               DateTime @updatedAt                                                                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │   user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)                                                                                                       │ │
│ │   items                   BatchItem[]                                                                                                                                                                     │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ model BatchItem {                                                                                                                                                                                         │ │
│ │   id                      String   @id @default(uuid())                                                                                                                                                   │ │
│ │   batchJobId              String                                                                                                                                                                          │ │
│ │   transcriptId            String?  @unique                                                                                                                                                                │ │
│ │   fileName                String                                                                                                                                                                          │ │
│ │   fileSize                Int                                                                                                                                                                             │ │
│ │   duration                Int      @default(0)                                                                                                                                                            │ │
│ │   status                  BatchItemStatus @default(PENDING)                                                                                                                                               │ │
│ │   progress                Int      @default(0)                                                                                                                                                            │ │
│ │   errorMessage            String?                                                                                                                                                                         │ │
│ │   eta                     Int?     // seconds                                                                                                                                                             │ │
│ │   confidence              Float?                                                                                                                                                                          │ │
│ │   createdAt               DateTime @default(now())                                                                                                                                                        │ │
│ │   updatedAt               DateTime @updatedAt                                                                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │   batchJob                BatchJob @relation(fields: [batchJobId], references: [id], onDelete: Cascade)                                                                                                   │ │
│ │   transcript              Transcript? @relation(fields: [transcriptId], references: [id])                                                                                                                 │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ enum BatchJobStatus {                                                                                                                                                                                     │ │
│ │   DRAFT                                                                                                                                                                                                   │ │
│ │   RUNNING                                                                                                                                                                                                 │ │
│ │   PAUSED                                                                                                                                                                                                  │ │
│ │   COMPLETED                                                                                                                                                                                               │ │
│ │   ERROR                                                                                                                                                                                                   │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ enum BatchItemStatus {                                                                                                                                                                                    │ │
│ │   PENDING                                                                                                                                                                                                 │ │
│ │   PROCESSING                                                                                                                                                                                              │ │
│ │   COMPLETED                                                                                                                                                                                               │ │
│ │   ERROR                                                                                                                                                                                                   │ │
│ │   CANCELLED                                                                                                                                                                                               │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing: Migration runs successfully, models created                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 1.2 Batch Queue Service                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/api/src/services/batchQueue.ts (new)                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ Implementation:                                                                                                                                                                                           │ │
│ │ - Extend existing queue.ts patterns                                                                                                                                                                       │ │
│ │ - Add batch job processing logic                                                                                                                                                                          │ │
│ │ - Implement concurrency control                                                                                                                                                                           │ │
│ │ - Add throughput calculation                                                                                                                                                                              │ │
│ │ - Add ETA estimation                                                                                                                                                                                      │ │
│ │ - WebSocket event emission for progress                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ Key Methods:                                                                                                                                                                                              │ │
│ │ - addBatchJob(batchJobId: string)                                                                                                                                                                         │ │
│ │ - pauseBatchJob(batchJobId: string)                                                                                                                                                                       │ │
│ │ - resumeBatchJob(batchJobId: string)                                                                                                                                                                      │ │
│ │ - cancelBatchJob(batchJobId: string)                                                                                                                                                                      │ │
│ │ - processBatchJob(job: BatchJob) - respects concurrency                                                                                                                                                   │ │
│ │ - updateBatchProgress(batchJobId: string) - calculates stats                                                                                                                                              │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Unit tests for concurrency limits                                                                                                                                                                       │ │
│ │ - Test ETA calculations                                                                                                                                                                                   │ │
│ │ - Test pause/resume functionality                                                                                                                                                                         │ │
│ │ - Test error handling and retries                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 1.3 Batch API Routes                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/api/src/routes/batch.ts (new)                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                           │ │
│ │ Endpoints:                                                                                                                                                                                                │ │
│ │ 1. POST /api/batch/jobs - Create batch job                                                                                                                                                                │ │
│ │ 2. GET /api/batch/jobs - List user's batch jobs (paginated)                                                                                                                                               │ │
│ │ 3. GET /api/batch/jobs/:id - Get single batch job with items                                                                                                                                              │ │
│ │ 4. PUT /api/batch/jobs/:id - Update batch job (name, concurrency)                                                                                                                                         │ │
│ │ 5. DELETE /api/batch/jobs/:id - Delete batch job                                                                                                                                                          │ │
│ │ 6. POST /api/batch/jobs/:id/start - Start processing                                                                                                                                                      │ │
│ │ 7. POST /api/batch/jobs/:id/pause - Pause processing                                                                                                                                                      │ │
│ │ 8. POST /api/batch/jobs/:id/resume - Resume processing                                                                                                                                                    │ │
│ │ 9. POST /api/batch/jobs/:id/cancel - Cancel all pending items                                                                                                                                             │ │
│ │ 10. POST /api/batch/jobs/:id/items - Add files to batch                                                                                                                                                   │ │
│ │ 11. DELETE /api/batch/jobs/:id/items/:itemId - Remove item                                                                                                                                                │ │
│ │ 12. POST /api/batch/jobs/:id/items/:itemId/retry - Retry failed item                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Integration tests for all endpoints                                                                                                                                                                     │ │
│ │ - Test authentication/authorization                                                                                                                                                                       │ │
│ │ - Test pagination                                                                                                                                                                                         │ │
│ │ - Test error responses (404, 400, 500)                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 1.4 WebSocket Events                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/api/src/services/batchQueue.ts (extend)                                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ Events to Emit:                                                                                                                                                                                           │ │
│ │ - batch:job_progress - Overall job progress update                                                                                                                                                        │ │
│ │ - batch:item_progress - Individual item transcription progress                                                                                                                                            │ │
│ │ - batch:item_completed - Item completed                                                                                                                                                                   │ │
│ │ - batch:item_error - Item failed                                                                                                                                                                          │ │
│ │ - batch:job_completed - All items completed                                                                                                                                                               │ │
│ │ - batch:job_paused - Job paused                                                                                                                                                                           │ │
│ │ - batch:job_resumed - Job resumed                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Mock WebSocket client tests                                                                                                                                                                             │ │
│ │ - Test event payload structure                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Phase 2: Frontend Store & API Client                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ 2.1 Batch Store (Zustand)                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/stores/batchStore.ts (new)                                                                                                                                                │ │
│ │                                                                                                                                                                                                           │ │
│ │ State Structure:                                                                                                                                                                                          │ │
│ │ interface BatchState {                                                                                                                                                                                    │ │
│ │   jobs: Record<string, BatchJob>;                                                                                                                                                                         │ │
│ │   currentJob: BatchJob | null;                                                                                                                                                                            │ │
│ │   items: Record<string, BatchItem[]>;                                                                                                                                                                     │ │
│ │   isLoading: boolean;                                                                                                                                                                                     │ │
│ │   isCreating: boolean;                                                                                                                                                                                    │ │
│ │   error: string | null;                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │   // Actions                                                                                                                                                                                              │ │
│ │   fetchJobs: () => Promise<void>;                                                                                                                                                                         │ │
│ │   fetchJob: (id: string) => Promise<void>;                                                                                                                                                                │ │
│ │   createJob: (name: string, concurrency?: number) => Promise<BatchJob>;                                                                                                                                   │ │
│ │   updateJob: (id: string, data: Partial<BatchJob>) => Promise<void>;                                                                                                                                      │ │
│ │   deleteJob: (id: string) => Promise<void>;                                                                                                                                                               │ │
│ │   startJob: (id: string) => Promise<void>;                                                                                                                                                                │ │
│ │   pauseJob: (id: string) => Promise<void>;                                                                                                                                                                │ │
│ │   resumeJob: (id: string) => Promise<void>;                                                                                                                                                               │ │
│ │   cancelJob: (id: string) => Promise<void>;                                                                                                                                                               │ │
│ │   addFiles: (jobId: string, files: File[]) => Promise<void>;                                                                                                                                              │ │
│ │   removeItem: (jobId: string, itemId: string) => Promise<void>;                                                                                                                                           │ │
│ │   retryItem: (jobId: string, itemId: string) => Promise<void>;                                                                                                                                            │ │
│ │   clearError: () => void;                                                                                                                                                                                 │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ WebSocket Integration (pattern from transcriptStore.ts):                                                                                                                                                  │ │
│ │ - Subscribe to batch events                                                                                                                                                                               │ │
│ │ - Update state on real-time events                                                                                                                                                                        │ │
│ │ - Handle progress updates                                                                                                                                                                                 │ │
│ │ - Handle errors                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Test each action                                                                                                                                                                                        │ │
│ │ - Test state updates                                                                                                                                                                                      │ │
│ │ - Mock API calls                                                                                                                                                                                          │ │
│ │ - Test WebSocket event handlers                                                                                                                                                                           │ │
│ │ - Test error states                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 2.2 API Client Extension                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/services/apiClient.ts (extend)                                                                                                                                            │ │
│ │                                                                                                                                                                                                           │ │
│ │ Add Methods:                                                                                                                                                                                              │ │
│ │ // Batch job management                                                                                                                                                                                   │ │
│ │ async getBatchJobs(page?: number, limit?: number): Promise<PaginatedResponse<BatchJob>>                                                                                                                   │ │
│ │ async getBatchJob(id: string): Promise<BatchJobWithItems>                                                                                                                                                 │ │
│ │ async createBatchJob(name: string, concurrency?: number): Promise<BatchJob>                                                                                                                               │ │
│ │ async updateBatchJob(id: string, data: Partial<BatchJob>): Promise<BatchJob>                                                                                                                              │ │
│ │ async deleteBatchJob(id: string): Promise<void>                                                                                                                                                           │ │
│ │ async startBatchJob(id: string): Promise<void>                                                                                                                                                            │ │
│ │ async pauseBatchJob(id: string): Promise<void>                                                                                                                                                            │ │
│ │ async resumeBatchJob(id: string): Promise<void>                                                                                                                                                           │ │
│ │ async cancelBatchJob(id: string): Promise<void>                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ // Batch item management                                                                                                                                                                                  │ │
│ │ async addFilesToBatch(jobId: string, files: File[], onProgress?: BatchProgressCallback): Promise<void>                                                                                                    │ │
│ │ async removeBatchItem(jobId: string, itemId: string): Promise<void>                                                                                                                                       │ │
│ │ async retryBatchItem(jobId: string, itemId: string): Promise<void>                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ // WebSocket subscriptions                                                                                                                                                                                │ │
│ │ subscribeToBatchJob(jobId: string): void                                                                                                                                                                  │ │
│ │ unsubscribeFromBatchJob(jobId: string): void                                                                                                                                                              │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Mock axios calls                                                                                                                                                                                        │ │
│ │ - Test error handling                                                                                                                                                                                     │ │
│ │ - Test retry logic                                                                                                                                                                                        │ │
│ │ - Test WebSocket subscriptions                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 2.3 TypeScript Type Definitions                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/types/api.ts (extend)                                                                                                                                                     │ │
│ │                                                                                                                                                                                                           │ │
│ │ Add Types:                                                                                                                                                                                                │ │
│ │ export type BatchJobStatus = 'DRAFT' | 'RUNNING' | 'PAUSED' | 'COMPLETED' | 'ERROR';                                                                                                                      │ │
│ │ export type BatchItemStatus = 'PENDING' | 'PROCESSING' | 'COMPLETED' | 'ERROR' | 'CANCELLED';                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │ export interface BatchJob {                                                                                                                                                                               │ │
│ │   id: string;                                                                                                                                                                                             │ │
│ │   name: string;                                                                                                                                                                                           │ │
│ │   status: BatchJobStatus;                                                                                                                                                                                 │ │
│ │   concurrency: number;                                                                                                                                                                                    │ │
│ │   totalItems: number;                                                                                                                                                                                     │ │
│ │   completedItems: number;                                                                                                                                                                                 │ │
│ │   failedItems: number;                                                                                                                                                                                    │ │
│ │   estimatedTimeRemaining?: number; // seconds                                                                                                                                                             │ │
│ │   throughputMbps?: number;                                                                                                                                                                                │ │
│ │   createdAt: string;                                                                                                                                                                                      │ │
│ │   updatedAt: string;                                                                                                                                                                                      │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ export interface BatchItem {                                                                                                                                                                              │ │
│ │   id: string;                                                                                                                                                                                             │ │
│ │   fileName: string;                                                                                                                                                                                       │ │
│ │   fileSize: number;                                                                                                                                                                                       │ │
│ │   duration: number;                                                                                                                                                                                       │ │
│ │   status: BatchItemStatus;                                                                                                                                                                                │ │
│ │   progress: number;                                                                                                                                                                                       │ │
│ │   errorMessage?: string;                                                                                                                                                                                  │ │
│ │   eta?: number; // seconds                                                                                                                                                                                │ │
│ │   confidence?: number;                                                                                                                                                                                    │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ export interface BatchJobWithItems extends BatchJob {                                                                                                                                                     │ │
│ │   items: BatchItem[];                                                                                                                                                                                     │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ export interface BatchProgressCallback {                                                                                                                                                                  │ │
│ │   (itemId: string, progress: number, loaded: number, total: number): void;                                                                                                                                │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Phase 3: Component Transformation                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ 3.1 BatchProcessor Component Refactor                                                                                                                                                                     │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/components/ui/batch-processor.tsx                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ Changes Required:                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ 1. Remove Mock Data (lines 66-123)                                                                                                                                                                        │ │
│ │ 2. Add Props:                                                                                                                                                                                             │ │
│ │ interface BatchProcessorProps {                                                                                                                                                                           │ │
│ │   className?: string;                                                                                                                                                                                     │ │
│ │   jobId?: string; // Selected batch job ID                                                                                                                                                                │ │
│ │   onJobChange?: (jobId: string | null) => void;                                                                                                                                                           │ │
│ │ }                                                                                                                                                                                                         │ │
│ │ 3. Add Hooks:                                                                                                                                                                                             │ │
│ │ const {                                                                                                                                                                                                   │ │
│ │   currentJob,                                                                                                                                                                                             │ │
│ │   items,                                                                                                                                                                                                  │ │
│ │   isLoading,                                                                                                                                                                                              │ │
│ │   startJob,                                                                                                                                                                                               │ │
│ │   pauseJob,                                                                                                                                                                                               │ │
│ │   cancelJob,                                                                                                                                                                                              │ │
│ │   addFiles,                                                                                                                                                                                               │ │
│ │   retryItem,                                                                                                                                                                                              │ │
│ │   removeItem,                                                                                                                                                                                             │ │
│ │   fetchJob                                                                                                                                                                                                │ │
│ │ } = useBatchStore();                                                                                                                                                                                      │ │
│ │ 4. Add File Upload:                                                                                                                                                                                       │ │
│ │   - Integrate react-dropzone (already in package.json)                                                                                                                                                    │ │
│ │   - Multi-file selection                                                                                                                                                                                  │ │
│ │   - Progress tracking per file                                                                                                                                                                            │ │
│ │   - Upload to batch via addFiles()                                                                                                                                                                        │ │
│ │ 5. Real-time Updates:                                                                                                                                                                                     │ │
│ │   - Subscribe to WebSocket on mount                                                                                                                                                                       │ │
│ │   - Update UI based on batch events                                                                                                                                                                       │ │
│ │   - Unsubscribe on unmount                                                                                                                                                                                │ │
│ │ 6. Data Transformations:                                                                                                                                                                                  │ │
│ │   - Convert backend seconds to display format (ETA, time remaining)                                                                                                                                       │ │
│ │   - Format file sizes (already implemented)                                                                                                                                                               │ │
│ │   - Calculate overall progress percentage (already implemented)                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Component renders with no job                                                                                                                                                                           │ │
│ │ - Component renders with job data                                                                                                                                                                         │ │
│ │ - Start/pause/stop buttons work                                                                                                                                                                           │ │
│ │ - File upload works                                                                                                                                                                                       │ │
│ │ - Multi-select works                                                                                                                                                                                      │ │
│ │ - Retry functionality works                                                                                                                                                                               │ │
│ │ - Remove item works                                                                                                                                                                                       │ │
│ │ - Real-time updates reflected                                                                                                                                                                             │ │
│ │ - Error states displayed                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 3.2 Batch Job Selection/Creation UI                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/components/ui/batch-job-selector.tsx (new)                                                                                                                                │ │
│ │                                                                                                                                                                                                           │ │
│ │ Purpose:                                                                                                                                                                                                  │ │
│ │ - List existing batch jobs                                                                                                                                                                                │ │
│ │ - Create new batch job                                                                                                                                                                                    │ │
│ │ - Switch between jobs                                                                                                                                                                                     │ │
│ │ - Delete jobs                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │ Props:                                                                                                                                                                                                    │ │
│ │ interface BatchJobSelectorProps {                                                                                                                                                                         │ │
│ │   selectedJobId: string | null;                                                                                                                                                                           │ │
│ │   onJobSelect: (jobId: string | null) => void;                                                                                                                                                            │ │
│ │ }                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements:                                                                                                                                                                                     │ │
│ │ - Renders job list                                                                                                                                                                                        │ │
│ │ - Create job dialog works                                                                                                                                                                                 │ │
│ │ - Job selection works                                                                                                                                                                                     │ │
│ │ - Delete confirmation works                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 3.3 Integration with VoiceFlowPro                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/pages/VoiceFlowPro.tsx                                                                                                                                                    │ │
│ │                                                                                                                                                                                                           │ │
│ │ Changes:                                                                                                                                                                                                  │ │
│ │ - Add state for selected batch job                                                                                                                                                                        │ │
│ │ - Pass jobId to BatchProcessor                                                                                                                                                                            │ │
│ │ - Show BatchJobSelector component                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ Current (lines 294-298):                                                                                                                                                                                  │ │
│ │ <BatchProcessor                                                                                                                                                                                           │ │
│ │   onStart={() => toast({ ... })}                                                                                                                                                                          │ │
│ │   onPause={() => toast({ ... })}                                                                                                                                                                          │ │
│ │   onStop={() => toast({ ... })}                                                                                                                                                                           │ │
│ │ />                                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ Updated:                                                                                                                                                                                                  │ │
│ │ <div className="flex h-full">                                                                                                                                                                             │ │
│ │   <BatchJobSelector                                                                                                                                                                                       │ │
│ │     selectedJobId={selectedBatchJobId}                                                                                                                                                                    │ │
│ │     onJobSelect={setSelectedBatchJobId}                                                                                                                                                                   │ │
│ │   />                                                                                                                                                                                                      │ │
│ │   <BatchProcessor                                                                                                                                                                                         │ │
│ │     jobId={selectedBatchJobId}                                                                                                                                                                            │ │
│ │     onJobChange={setSelectedBatchJobId}                                                                                                                                                                   │ │
│ │   />                                                                                                                                                                                                      │ │
│ │ </div>                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Phase 4: Testing Implementation                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ 4.1 Jest Configuration                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/jest.config.ts (new)                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ Setup:                                                                                                                                                                                                    │ │
│ │ export default {                                                                                                                                                                                          │ │
│ │   preset: 'ts-jest',                                                                                                                                                                                      │ │
│ │   testEnvironment: 'jsdom',                                                                                                                                                                               │ │
│ │   moduleNameMapper: {                                                                                                                                                                                     │ │
│ │     '^@/(.*)$': '<rootDir>/src/renderer/$1',                                                                                                                                                              │ │
│ │     '\\.(css|less|scss|sass)$': 'identity-obj-proxy',                                                                                                                                                     │ │
│ │   },                                                                                                                                                                                                      │ │
│ │   setupFilesAfterEnv: ['<rootDir>/src/renderer/test/setup.ts'],                                                                                                                                           │ │
│ │   collectCoverageFrom: [                                                                                                                                                                                  │ │
│ │     'src/renderer/**/*.{ts,tsx}',                                                                                                                                                                         │ │
│ │     '!src/renderer/**/*.d.ts',                                                                                                                                                                            │ │
│ │     '!src/renderer/test/**',                                                                                                                                                                              │ │
│ │   ],                                                                                                                                                                                                      │ │
│ │   coverageThresholds: {                                                                                                                                                                                   │ │
│ │     global: {                                                                                                                                                                                             │ │
│ │       statements: 70,                                                                                                                                                                                     │ │
│ │       branches: 60,                                                                                                                                                                                       │ │
│ │       functions: 70,                                                                                                                                                                                      │ │
│ │       lines: 70,                                                                                                                                                                                          │ │
│ │     },                                                                                                                                                                                                    │ │
│ │   },                                                                                                                                                                                                      │ │
│ │ };                                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ Additional Packages Needed:                                                                                                                                                                               │ │
│ │ - @testing-library/react                                                                                                                                                                                  │ │
│ │ - @testing-library/jest-dom                                                                                                                                                                               │ │
│ │ - @testing-library/user-event                                                                                                                                                                             │ │
│ │ - jest-environment-jsdom                                                                                                                                                                                  │ │
│ │ - @types/jest                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 4.2 Test Setup File                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/test/setup.ts (new)                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ Setup:                                                                                                                                                                                                    │ │
│ │ - Import @testing-library/jest-dom/extend-expect                                                                                                                                                          │ │
│ │ - Mock Electron APIs                                                                                                                                                                                      │ │
│ │ - Mock WebSocket                                                                                                                                                                                          │ │
│ │ - Global test utilities                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 4.3 Store Tests                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/stores/batchStore.test.ts (new)                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ Test Cases:                                                                                                                                                                                               │ │
│ │ 1. Initial state is correct                                                                                                                                                                               │ │
│ │ 2. fetchJobs updates state                                                                                                                                                                                │ │
│ │ 3. createJob adds new job                                                                                                                                                                                 │ │
│ │ 4. startJob updates job status                                                                                                                                                                            │ │
│ │ 5. pauseJob updates job status                                                                                                                                                                            │ │
│ │ 6. deleteJob removes job                                                                                                                                                                                  │ │
│ │ 7. addFiles uploads files and updates items                                                                                                                                                               │ │
│ │ 8. retryItem re-queues failed item                                                                                                                                                                        │ │
│ │ 9. removeItem deletes item                                                                                                                                                                                │ │
│ │ 10. WebSocket events update state                                                                                                                                                                         │ │
│ │ 11. Error handling sets error state                                                                                                                                                                       │ │
│ │ 12. Loading states toggle correctly                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ Pattern: Use renderHook from @testing-library/react-hooks                                                                                                                                                 │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 4.4 Component Tests                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/components/ui/batch-processor.test.tsx (new)                                                                                                                              │ │
│ │                                                                                                                                                                                                           │ │
│ │ Test Cases:                                                                                                                                                                                               │ │
│ │ 1. Renders empty state when no job selected                                                                                                                                                               │ │
│ │ 2. Renders job details when job provided                                                                                                                                                                  │ │
│ │ 3. Renders items list correctly                                                                                                                                                                           │ │
│ │ 4. Start button calls startJob                                                                                                                                                                            │ │
│ │ 5. Pause button calls pauseJob                                                                                                                                                                            │ │
│ │ 6. Stop button calls cancelJob                                                                                                                                                                            │ │
│ │ 7. File upload triggers addFiles                                                                                                                                                                          │ │
│ │ 8. Retry button on error item calls retryItem                                                                                                                                                             │ │
│ │ 9. Remove item calls removeItem                                                                                                                                                                           │ │
│ │ 10. Multi-select works                                                                                                                                                                                    │ │
│ │ 11. Bulk retry works                                                                                                                                                                                      │ │
│ │ 12. Bulk remove works                                                                                                                                                                                     │ │
│ │ 13. Progress bars update correctly                                                                                                                                                                        │ │
│ │ 14. Status badges display correctly                                                                                                                                                                       │ │
│ │ 15. Error messages display                                                                                                                                                                                │ │
│ │ 16. Real-time progress updates                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                           │ │
│ │ Pattern: Use render, screen, fireEvent from @testing-library/react                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ 4.5 API Client Tests                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ File: apps/desktop/src/renderer/services/apiClient.batch.test.ts (new)                                                                                                                                    │ │
│ │                                                                                                                                                                                                           │ │
│ │ Test Cases:                                                                                                                                                                                               │ │
│ │ 1. getBatchJobs returns paginated results                                                                                                                                                                 │ │
│ │ 2. createBatchJob sends correct payload                                                                                                                                                                   │ │
│ │ 3. startBatchJob calls correct endpoint                                                                                                                                                                   │ │
│ │ 4. addFilesToBatch uploads files with progress                                                                                                                                                            │ │
│ │ 5. Error responses are normalized                                                                                                                                                                         │ │
│ │ 6. Retry logic works                                                                                                                                                                                      │ │
│ │ 7. WebSocket subscription works                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ Pattern: Mock axios with jest.mock('axios')                                                                                                                                                               │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Phase 5: Migration & Regression Prevention                                                                                                                                                                │ │
│ │                                                                                                                                                                                                           │ │
│ │ 5.1 Pre-Implementation Checklist                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                           │ │
│ │ - All existing tests pass                                                                                                                                                                                 │ │
│ │ - No TypeScript errors                                                                                                                                                                                    │ │
│ │ - No ESLint errors                                                                                                                                                                                        │ │
│ │ - Baseline performance metrics recorded                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ 5.2 Implementation Order                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                           │ │
│ │ 1. Backend database schema (run migration)                                                                                                                                                                │ │
│ │ 2. Backend batch queue service (unit tests)                                                                                                                                                               │ │
│ │ 3. Backend API routes (integration tests)                                                                                                                                                                 │ │
│ │ 4. Frontend types                                                                                                                                                                                         │ │
│ │ 5. Frontend API client methods (unit tests)                                                                                                                                                               │ │
│ │ 6. Frontend batch store (unit tests)                                                                                                                                                                      │ │
│ │ 7. Frontend component transformation (component tests)                                                                                                                                                    │ │
│ │ 8. Integration testing                                                                                                                                                                                    │ │
│ │ 9. End-to-end smoke tests                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                           │ │
│ │ 5.3 Regression Tests                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ Critical Paths to Test:                                                                                                                                                                                   │ │
│ │ - Single file upload still works                                                                                                                                                                          │ │
│ │ - TranscriptEditor still works                                                                                                                                                                            │ │
│ │ - TranscriptionPage still works                                                                                                                                                                           │ │
│ │ - Dashboard polling not affected                                                                                                                                                                          │ │
│ │ - Rate limiting still respected                                                                                                                                                                           │ │
│ │ - WebSocket for individual transcripts still works                                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ 5.4 Rollback Plan                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ - Keep mock data commented out (don't delete)                                                                                                                                                             │ │
│ │ - Feature flag for batch processing                                                                                                                                                                       │ │
│ │ - Database migration rollback script                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Phase 6: Performance & Optimization                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                           │ │
│ │ 6.1 Performance Considerations                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                           │ │
│ │ - Debounce WebSocket updates (max 2 updates/sec per job)                                                                                                                                                  │ │
│ │ - Lazy load batch items (virtualize list for 100+ items)                                                                                                                                                  │ │
│ │ - Cache batch job list                                                                                                                                                                                    │ │
│ │ - Optimize re-renders with React.memo                                                                                                                                                                     │ │
│ │ - Use useCallback for event handlers                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ 6.2 Error Handling                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ - Network error recovery                                                                                                                                                                                  │ │
│ │ - WebSocket reconnection                                                                                                                                                                                  │ │
│ │ - File upload retry with exponential backoff                                                                                                                                                              │ │
│ │ - User-friendly error messages                                                                                                                                                                            │ │
│ │ - Error boundary for component                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Success Criteria                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                           │ │
│ │ Functional Requirements                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ ✅ Create batch job with custom name and concurrency                                                                                                                                                       │ │
│ │ ✅ Add multiple files to batch job                                                                                                                                                                         │ │
│ │ ✅ Start/pause/resume/cancel batch processing                                                                                                                                                              │ │
│ │ ✅ Real-time progress updates via WebSocket                                                                                                                                                                │ │
│ │ ✅ Individual item retry on failure                                                                                                                                                                        │ │
│ │ ✅ Accurate ETA and throughput calculations                                                                                                                                                                │ │
│ │ ✅ Multi-select batch operations                                                                                                                                                                           │ │
│ │ ✅ Persist batch jobs across sessions                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ Non-Functional Requirements                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                           │ │
│ │ ✅ All unit tests pass (>70% coverage)                                                                                                                                                                     │ │
│ │ ✅ No regressions in existing features                                                                                                                                                                     │ │
│ │ ✅ TypeScript strict mode compliant                                                                                                                                                                        │ │
│ │ ✅ No ESLint errors                                                                                                                                                                                        │ │
│ │ ✅ Performance: UI updates <100ms                                                                                                                                                                          │ │
│ │ ✅ Handle 100+ items in single batch without lag                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Requirements                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                           │ │
│ │ ✅ Unit tests for batchStore (12+ tests)                                                                                                                                                                   │ │
│ │ ✅ Unit tests for API client methods (7+ tests)                                                                                                                                                            │ │
│ │ ✅ Component tests for BatchProcessor (16+ tests)                                                                                                                                                          │ │
│ │ ✅ Integration tests for batch API routes (12+ tests)                                                                                                                                                      │ │
│ │ ✅ Regression tests for existing features pass                                                                                                                                                             │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Risk Mitigation                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ High Risk Areas                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                           │ │
│ │ 1. WebSocket connection stability: Fallback to polling if WS fails                                                                                                                                        │ │
│ │ 2. Concurrent processing: Ensure queue respects limits                                                                                                                                                    │ │
│ │ 3. File upload failures: Implement retry with exponential backoff                                                                                                                                         │ │
│ │ 4. Memory leaks: Proper cleanup in useEffect hooks                                                                                                                                                        │ │
│ │ 5. Race conditions: Use proper state updates in Zustand                                                                                                                                                   │ │
│ │                                                                                                                                                                                                           │ │
│ │ Testing Strategies                                                                                                                                                                                        │ │
│ │                                                                                                                                                                                                           │ │
│ │ - Mock all external dependencies                                                                                                                                                                          │ │
│ │ - Test error scenarios explicitly                                                                                                                                                                         │ │
│ │ - Load test with large batches (100+ files)                                                                                                                                                               │ │
│ │ - Test WebSocket disconnect/reconnect                                                                                                                                                                     │ │
│ │ - Test concurrent batch jobs                                                                                                                                                                              │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Timeline Estimate                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                           │ │
│ │ | Phase   | Tasks                  | Estimated Time |                                                                                                                                                     │ │
│ │ |---------|------------------------|----------------|                                                                                                                                                     │ │
│ │ | Phase 1 | Backend Infrastructure | 4-6 hours      |                                                                                                                                                     │ │
│ │ | Phase 2 | Frontend Store & API   | 3-4 hours      |                                                                                                                                                     │ │
│ │ | Phase 3 | Component Transform    | 3-4 hours      |                                                                                                                                                     │ │
│ │ | Phase 4 | Testing Implementation | 4-6 hours      |                                                                                                                                                     │ │
│ │ | Phase 5 | Migration & Regression | 2-3 hours      |                                                                                                                                                     │ │
│ │ | Phase 6 | Performance & Polish   | 2-3 hours      |                                                                                                                                                     │ │
│ │ | Total   |                        | 18-26 hours    |                                                                                                                                                     │ │
│ │                                                                                                                                                                                                           │ │
│ │ ---                                                                                                                                                                                                       │ │
│ │ Next Steps                                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                           │ │
│ │ 1. Review and approve this plan                                                                                                                                                                           │ │
│ │ 2. Set up Jest testing infrastructure                                                                                                                                                                     │ │
│ │ 3. Start with Phase 1: Backend database schema                                                                                                                                                            │ │
│ │ 4. Implement incrementally, phase by phase                                                                                                                                                                │ │
│ │ 5. Run tests after each phase                                                                                                                                                                             │ │
│ │ 6. Document any deviations from plan                                                                                                                                                                      │ │
│ ╰──────────────────────────────────────